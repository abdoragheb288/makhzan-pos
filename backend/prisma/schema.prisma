generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== ENUMS ====================

enum UserRole {
  ADMIN
  MANAGER
  CASHIER
}

enum TransferStatus {
  PENDING
  APPROVED
  IN_TRANSIT
  COMPLETED
  CANCELLED
}

enum PaymentMethod {
  CASH
  CARD
  CREDIT
}

enum PurchaseStatus {
  PENDING
  PARTIAL
  RECEIVED
  CANCELLED
}

// Multi-Tenant Enums
enum TenantStatus {
  TRIAL
  ACTIVE
  SUSPENDED
  EXPIRED
}

enum SubscriptionPlan {
  MONTHLY
  QUARTERLY
  SEMI_ANNUAL
  ANNUAL
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
}

// ==================== MODELS ====================

// ========== MULTI-TENANT MODELS ==========

model SuperAdmin {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(100)
  email     String   @unique @db.VarChar(100)
  password  String   @db.VarChar(255)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("super_admins")
}

model Tenant {
  id           Int          @id @default(autoincrement())
  name         String       @db.VarChar(150) // Company/Store name
  email        String       @unique @db.VarChar(100)
  phone        String?      @db.VarChar(20)
  businessType String       @default("retail") @map("business_type") @db.VarChar(20) // restaurant, cafe, retail, supermarket
  status       TenantStatus @default(TRIAL)
  trialEndsAt  DateTime?    @map("trial_ends_at")
  isActive     Boolean      @default(true) @map("is_active")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  subscriptions Subscription[]
  users         User[]
  branches      Branch[]
  categories    Category[]
  products      Product[]
  suppliers     Supplier[]
  orders        Order[]
  tables        RestaurantTable[]
  customers     Customer[]

  @@map("tenants")
}

model Subscription {
  id        Int                @id @default(autoincrement())
  tenantId  Int                @map("tenant_id")
  plan      SubscriptionPlan
  status    SubscriptionStatus @default(ACTIVE)
  startsAt  DateTime           @map("starts_at")
  endsAt    DateTime           @map("ends_at")
  amount    Decimal?           @db.Decimal(10, 2)
  notes     String?            @db.Text
  createdAt DateTime           @default(now()) @map("created_at")

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

// ========== EXISTING MODELS (with tenantId) ==========

model User {
  id          Int      @id @default(autoincrement())
  tenantId    Int      @map("tenant_id")
  name        String   @db.VarChar(100)
  email       String   @unique @db.VarChar(100)
  password    String   @db.VarChar(255)
  phone       String?  @db.VarChar(20)
  role        UserRole @default(CASHIER)
  permissions Json?    // Array of strings e.g. ["pos", "products", "reports"]
  branchId    Int?     @map("branch_id")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  branch         Branch?         @relation(fields: [branchId], references: [id])
  sales          Sale[]
  stockTransfers StockTransfer[] @relation("CreatedByUser")
  purchaseOrders PurchaseOrder[]
  auditLogs      AuditLog[]
  returns        Return[]
  expenses       Expense[]
  shifts         Shift[]
  installments   Installment[]
  commissions    Commission[]
  orders         Order[]

  @@map("users")
}

model Branch {
  id          Int      @id @default(autoincrement())
  tenantId    Int      @map("tenant_id")
  name        String   @db.VarChar(100)
  address     String?  @db.VarChar(255)
  phone       String?  @db.VarChar(20)
  isWarehouse Boolean  @default(false) @map("is_warehouse")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users              User[]
  inventory          Inventory[]
  sales              Sale[]
  transfersFrom      StockTransfer[] @relation("FromBranch")
  transfersTo        StockTransfer[] @relation("ToBranch")
  purchaseOrders     PurchaseOrder[]
  returns            Return[]
  expenses           Expense[]
  shifts             Shift[]
  installments       Installment[]
  preOrders          PreOrder[]
  recurringExpenses  RecurringExpense[]
  orders             Order[]
  tables             RestaurantTable[]

  @@map("branches")
}

model Category {
  id          Int        @id @default(autoincrement())
  tenantId    Int        @map("tenant_id")
  name        String     @db.VarChar(100)
  description String?    @db.Text
  parentId    Int?       @map("parent_id")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")

  tenant   Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")
  products Product[]

  @@map("categories")
}

model Product {
  id          Int      @id @default(autoincrement())
  tenantId    Int      @map("tenant_id")
  name        String   @db.VarChar(150)
  sku         String   @db.VarChar(50)
  barcode     String?  @db.VarChar(50)
  categoryId  Int      @map("category_id")
  basePrice   Decimal  @default(0) @map("base_price") @db.Decimal(10, 2)
  costPrice   Decimal  @default(0) @map("cost_price") @db.Decimal(10, 2)
  description String?  @db.Text
  image       String?  @db.VarChar(255)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  tenant   Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  category Category         @relation(fields: [categoryId], references: [id])
  variants ProductVariant[]
  orderItems OrderItem[]

  @@unique([tenantId, sku])
  @@map("products")
}

model ProductVariant {
  id        Int      @id @default(autoincrement())
  productId Int      @map("product_id")
  size      String?  @db.VarChar(20)
  color     String?  @db.VarChar(50)
  sku       String   @unique @db.VarChar(60)
  barcode   String?  @unique @db.VarChar(50)
  price     Decimal  @default(0) @db.Decimal(10, 2)
  costPrice Decimal  @default(0) @map("cost_price") @db.Decimal(10, 2)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  product       Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  inventory     Inventory[]
  saleItems     SaleItem[]
  transferItems TransferItem[]
  purchaseItems PurchaseItem[]
  returnItems   ReturnItem[]
  preOrders     PreOrder[]
  orderItems    OrderItem[]

  @@map("product_variants")
}

model Inventory {
  id          Int      @id @default(autoincrement())
  variantId   Int      @map("variant_id")
  branchId    Int      @map("branch_id")
  quantity    Int      @default(0)
  minStock    Int      @default(5) @map("min_stock")
  lastUpdated DateTime @default(now()) @updatedAt @map("last_updated")

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  branch  Branch         @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@unique([variantId, branchId])
  @@map("inventory")
}

model StockTransfer {
  id           Int            @id @default(autoincrement())
  fromBranchId Int            @map("from_branch_id")
  toBranchId   Int            @map("to_branch_id")
  status       TransferStatus @default(PENDING)
  notes        String?        @db.Text
  createdById  Int            @map("created_by")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")

  fromBranch Branch         @relation("FromBranch", fields: [fromBranchId], references: [id])
  toBranch   Branch         @relation("ToBranch", fields: [toBranchId], references: [id])
  createdBy  User           @relation("CreatedByUser", fields: [createdById], references: [id])
  items      TransferItem[]

  @@map("stock_transfers")
}

model TransferItem {
  id         Int @id @default(autoincrement())
  transferId Int @map("transfer_id")
  variantId  Int @map("variant_id")
  quantity   Int

  transfer StockTransfer  @relation(fields: [transferId], references: [id], onDelete: Cascade)
  variant  ProductVariant @relation(fields: [variantId], references: [id])

  @@map("transfer_items")
}

model Supplier {
  id        Int      @id @default(autoincrement())
  tenantId  Int      @map("tenant_id")
  name      String   @db.VarChar(100)
  phone     String?  @db.VarChar(20)
  email     String?  @db.VarChar(100)
  address   String?  @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  purchaseOrders PurchaseOrder[]

  @@map("suppliers")
}

model PurchaseOrder {
  id         Int            @id @default(autoincrement())
  supplierId Int            @map("supplier_id")
  branchId   Int            @map("branch_id")
  status     PurchaseStatus @default(PENDING)
  total      Decimal        @default(0) @db.Decimal(12, 2)
  notes      String?        @db.Text
  createdById Int           @map("created_by")
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")

  supplier  Supplier       @relation(fields: [supplierId], references: [id])
  branch    Branch         @relation(fields: [branchId], references: [id])
  createdBy User           @relation(fields: [createdById], references: [id])
  items     PurchaseItem[]

  @@map("purchase_orders")
}

model PurchaseItem {
  id        Int     @id @default(autoincrement())
  orderId   Int     @map("order_id")
  variantId Int     @map("variant_id")
  quantity  Int
  unitCost  Decimal @map("unit_cost") @db.Decimal(10, 2)
  received  Int     @default(0)

  order   PurchaseOrder  @relation(fields: [orderId], references: [id], onDelete: Cascade)
  variant ProductVariant @relation(fields: [variantId], references: [id])

  @@map("purchase_items")
}

model Sale {
  id            Int           @id @default(autoincrement())
  branchId      Int           @map("branch_id")
  userId        Int           @map("user_id")
  invoiceNumber String        @unique @map("invoice_number") @db.VarChar(30)
  subtotal      Decimal       @default(0) @db.Decimal(12, 2)
  discount      Decimal       @default(0) @db.Decimal(10, 2)
  discountType  String        @default("amount") @map("discount_type") @db.VarChar(10)
  tax           Decimal       @default(0) @db.Decimal(10, 2)
  total         Decimal       @default(0) @db.Decimal(12, 2)
  paid          Decimal       @default(0) @db.Decimal(12, 2)
  change        Decimal       @default(0) @db.Decimal(10, 2)
  paymentMethod PaymentMethod @default(CASH) @map("payment_method")
  notes         String?       @db.Text
  createdAt     DateTime      @default(now()) @map("created_at")

  branch       Branch        @relation(fields: [branchId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  items        SaleItem[]
  returns      Return[]
  installments Installment[]
  commissions  Commission[]
  order        Order?

  @@map("sales")
}

model SaleItem {
  id        Int     @id @default(autoincrement())
  saleId    Int     @map("sale_id")
  variantId Int     @map("variant_id")
  quantity  Int
  unitPrice Decimal @map("unit_price") @db.Decimal(10, 2)
  discount  Decimal @default(0) @db.Decimal(10, 2)
  total     Decimal @db.Decimal(12, 2)

  sale    Sale           @relation(fields: [saleId], references: [id], onDelete: Cascade)
  variant ProductVariant @relation(fields: [variantId], references: [id])

  @@map("sale_items")
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  action    String   @db.VarChar(50)
  entity    String   @db.VarChar(50)
  entityId  Int?     @map("entity_id")
  oldData   Json?    @map("old_data")
  newData   Json?    @map("new_data")
  ipAddress String?  @map("ip_address") @db.VarChar(45)
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

model Settings {
  id        Int      @id @default(autoincrement())
  key       String   @unique @db.VarChar(50)
  value     String   @db.Text
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("settings")
}

// ==================== PHASE 2: RETURNS ====================

model Return {
  id            Int      @id @default(autoincrement())
  saleId        Int      @map("sale_id")
  branchId      Int      @map("branch_id")
  userId        Int      @map("user_id")
  returnNumber  String   @unique @map("return_number") @db.VarChar(30)
  reason        String   @db.VarChar(100)
  notes         String?  @db.Text
  totalRefund   Decimal  @default(0) @map("total_refund") @db.Decimal(12, 2)
  createdAt     DateTime @default(now()) @map("created_at")

  sale    Sale         @relation(fields: [saleId], references: [id])
  branch  Branch       @relation(fields: [branchId], references: [id])
  user    User         @relation(fields: [userId], references: [id])
  items   ReturnItem[]

  @@map("returns")
}

model ReturnItem {
  id        Int     @id @default(autoincrement())
  returnId  Int     @map("return_id")
  variantId Int     @map("variant_id")
  quantity  Int
  unitPrice Decimal @map("unit_price") @db.Decimal(10, 2)
  total     Decimal @db.Decimal(12, 2)

  return  Return         @relation(fields: [returnId], references: [id], onDelete: Cascade)
  variant ProductVariant @relation(fields: [variantId], references: [id])

  @@map("return_items")
}

// ==================== PHASE 4: EXPENSES ====================

model Expense {
  id          Int      @id @default(autoincrement())
  branchId    Int      @map("branch_id")
  userId      Int      @map("user_id")
  category    String   @db.VarChar(50)
  description String?  @db.VarChar(255)
  amount      Decimal  @db.Decimal(12, 2)
  date        DateTime @default(now())
  createdAt   DateTime @default(now()) @map("created_at")

  branch Branch @relation(fields: [branchId], references: [id])
  user   User   @relation(fields: [userId], references: [id])

  @@map("expenses")
}

// ==================== PHASE 5: SHIFTS ====================

model Shift {
  id             Int       @id @default(autoincrement())
  branchId       Int       @map("branch_id")
  userId         Int       @map("user_id")
  openingBalance Decimal   @map("opening_balance") @db.Decimal(12, 2)
  closingBalance Decimal?  @map("closing_balance") @db.Decimal(12, 2)
  expectedCash   Decimal?  @map("expected_cash") @db.Decimal(12, 2)
  actualCash     Decimal?  @map("actual_cash") @db.Decimal(12, 2)
  difference     Decimal?  @db.Decimal(10, 2)
  notes          String?   @db.Text
  openedAt       DateTime  @default(now()) @map("opened_at")
  closedAt       DateTime? @map("closed_at")

  branch       Branch            @relation(fields: [branchId], references: [id])
  user         User              @relation(fields: [userId], references: [id])
  transactions CashTransaction[]

  @@map("shifts")
}

model CashTransaction {
  id        Int      @id @default(autoincrement())
  shiftId   Int      @map("shift_id")
  type      String   @db.VarChar(20) // DEPOSIT, WITHDRAWAL
  amount    Decimal  @db.Decimal(12, 2)
  reason    String   @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at")

  shift Shift @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@map("cash_transactions")
}

// ==================== PHASE 3: DISCOUNTS ====================

model Discount {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(100)
  code        String?   @unique @db.VarChar(30)
  type        String    @db.VarChar(20) // PERCENTAGE, AMOUNT
  value       Decimal   @db.Decimal(10, 2)
  minPurchase Decimal?  @map("min_purchase") @db.Decimal(12, 2)
  maxUses     Int?      @map("max_uses")
  usedCount   Int       @default(0) @map("used_count")
  startDate   DateTime? @map("start_date")
  endDate     DateTime? @map("end_date")
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")

  @@map("discounts")
}

// ==================== PHASE 9: INSTALLMENTS ====================

model Installment {
  id              Int       @id @default(autoincrement())
  saleId          Int       @map("sale_id")
  branchId        Int       @map("branch_id")
  userId          Int       @map("user_id")
  customerName    String    @map("customer_name") @db.VarChar(100)
  customerPhone   String    @map("customer_phone") @db.VarChar(20)
  totalAmount     Decimal   @map("total_amount") @db.Decimal(12, 2)
  downPayment     Decimal   @map("down_payment") @db.Decimal(12, 2)
  remainingAmount Decimal   @map("remaining_amount") @db.Decimal(12, 2)
  numberOfPayments Int      @map("number_of_payments")
  paymentPerMonth Decimal   @map("payment_per_month") @db.Decimal(12, 2)
  startDate       DateTime  @default(now()) @map("start_date")
  nextDueDate     DateTime  @map("next_due_date")
  status          String    @default("ACTIVE") @db.VarChar(20) // ACTIVE, COMPLETED, OVERDUE, CANCELLED
  notes           String?   @db.Text
  createdAt       DateTime  @default(now()) @map("created_at")

  sale     Sale   @relation(fields: [saleId], references: [id])
  branch   Branch @relation(fields: [branchId], references: [id])
  user     User   @relation(fields: [userId], references: [id])
  payments InstallmentPayment[]

  @@map("installments")
}

model InstallmentPayment {
  id            Int      @id @default(autoincrement())
  installmentId Int      @map("installment_id")
  amount        Decimal  @db.Decimal(12, 2)
  paymentDate   DateTime @default(now()) @map("payment_date")
  paymentMethod String   @default("CASH") @map("payment_method") @db.VarChar(20)
  notes         String?  @db.Text
  createdAt     DateTime @default(now()) @map("created_at")

  installment Installment @relation(fields: [installmentId], references: [id])

  @@map("installment_payments")
}

// ==================== PRE-ORDERS ====================

model PreOrder {
  id            Int       @id @default(autoincrement())
  branchId      Int       @map("branch_id")
  variantId     Int       @map("variant_id")
  customerName  String    @map("customer_name") @db.VarChar(100)
  customerPhone String    @map("customer_phone") @db.VarChar(20)
  quantity      Int       @default(1)
  notes         String?   @db.Text
  status        String    @default("PENDING") @db.VarChar(20) // PENDING, NOTIFIED, COMPLETED, CANCELLED
  notifiedAt    DateTime? @map("notified_at")
  completedAt   DateTime? @map("completed_at")
  createdAt     DateTime  @default(now()) @map("created_at")

  branch  Branch         @relation(fields: [branchId], references: [id])
  variant ProductVariant @relation(fields: [variantId], references: [id])

  @@map("pre_orders")
}

// ==================== RECURRING EXPENSES ====================

model RecurringExpense {
  id           Int       @id @default(autoincrement())
  branchId     Int       @map("branch_id")
  category     String    @db.VarChar(50)
  description  String?   @db.VarChar(255)
  amount       Decimal   @db.Decimal(12, 2)
  frequency    String    @db.VarChar(20) // DAILY, WEEKLY, MONTHLY, YEARLY
  dayOfMonth   Int?      @map("day_of_month") // For monthly: 1-31
  nextDueDate  DateTime  @map("next_due_date")
  isActive     Boolean   @default(true) @map("is_active")
  lastPaidAt   DateTime? @map("last_paid_at")
  createdAt    DateTime  @default(now()) @map("created_at")

  branch Branch @relation(fields: [branchId], references: [id])

  @@map("recurring_expenses")
}

// ==================== EMPLOYEE COMMISSION ====================

model Commission {
  id         Int      @id @default(autoincrement())
  userId     Int      @map("user_id")
  saleId     Int      @map("sale_id")
  saleTotal  Decimal  @map("sale_total") @db.Decimal(12, 2)
  rate       Decimal  @db.Decimal(5, 2) // Percentage rate
  amount     Decimal  @db.Decimal(12, 2)
  isPaid     Boolean  @default(false) @map("is_paid")
  paidAt     DateTime? @map("paid_at")
  createdAt  DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])
  sale Sale @relation(fields: [saleId], references: [id])

  @@map("commissions")
}

// ==================== CUSTOMER MODEL (DELIVERY) ====================

model Customer {
  id        Int      @id @default(autoincrement())
  tenantId  Int      @map("tenant_id")
  name      String   @db.VarChar(100)
  phone     String   @db.VarChar(20)
  address   String?  @db.Text
  notes     String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  tenant Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  orders Order[]

  @@unique([tenantId, phone])
  @@map("customers")
}

// ==================== RESTAURANT/CAFE MODELS ====================

model RestaurantTable {
  id        Int      @id @default(autoincrement())
  tenantId  Int      @map("tenant_id")
  branchId  Int      @map("branch_id")
  name      String   @db.VarChar(50)  // "Table 1", "T-05", "Outdoor 3"
  capacity  Int      @default(4)
  status    String   @default("available") @db.VarChar(20) // available, occupied, reserved
  position  Int      @default(0) // For ordering/sorting
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  tenant  Tenant  @relation(fields: [tenantId], references: [id])
  branch  Branch  @relation(fields: [branchId], references: [id])
  orders  Order[]

  @@map("restaurant_tables")
}

model Order {
  id               Int       @id @default(autoincrement())
  tenantId         Int       @map("tenant_id")
  branchId         Int       @map("branch_id")
  tableId          Int?      @map("table_id")
  userId           Int       @map("user_id")
  customerId       Int?      @map("customer_id") // For delivery orders
  orderNumber      String    @unique @map("order_number") @db.VarChar(30)
  shiftOrderNumber Int?      @map("shift_order_number") // Order number within shift (resets each shift)
  orderType        String    @default("dine_in") @map("order_type") @db.VarChar(20) // dine_in, takeaway, delivery
  status           String    @default("pending") @db.VarChar(20) // pending, preparing, ready, served, paid, cancelled
  subtotal         Decimal   @db.Decimal(12, 2)
  discount         Decimal   @default(0) @db.Decimal(10, 2)
  deliveryFee      Decimal   @default(0) @map("delivery_fee") @db.Decimal(10, 2)
  tax              Decimal   @default(0) @db.Decimal(10, 2)
  total            Decimal   @db.Decimal(12, 2)
  notes            String?   @db.Text // Kitchen notes
  customerName     String?   @map("customer_name") @db.VarChar(100)
  customerPhone    String?   @map("customer_phone") @db.VarChar(20)
  customerAddress  String?   @map("customer_address") @db.Text
  driverName       String?   @map("driver_name") @db.VarChar(100)
  sentToKitchenAt  DateTime? @map("sent_to_kitchen_at")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")
  paidAt           DateTime? @map("paid_at")
  saleId           Int?      @unique @map("sale_id") // Link to Sale after payment

  tenant   Tenant           @relation(fields: [tenantId], references: [id])
  branch   Branch           @relation(fields: [branchId], references: [id])
  table    RestaurantTable? @relation(fields: [tableId], references: [id])
  user     User             @relation(fields: [userId], references: [id])
  customer Customer?        @relation(fields: [customerId], references: [id])
  sale     Sale?            @relation(fields: [saleId], references: [id])
  items    OrderItem[]

  @@map("orders")
}

model OrderItem {
  id          Int      @id @default(autoincrement())
  orderId     Int      @map("order_id")
  productId   Int      @map("product_id")
  variantId   Int?     @map("variant_id")
  quantity    Int
  unitPrice   Decimal  @map("unit_price") @db.Decimal(10, 2)
  notes       String?  @db.VarChar(255)  // Special instructions: "no onions", "extra cheese"
  status      String   @default("pending") @db.VarChar(20) // pending, preparing, ready, served
  createdAt   DateTime @default(now()) @map("created_at")

  order   Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@map("order_items")
}
